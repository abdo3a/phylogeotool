args <- commandArgs(trailingOnly = TRUE)

#Yes
#SDRIn = "[0.8407416483503392, 0.8098430768931457, 0.7318164102885395, 0.7032717540265562, 0.6898834172891566, 0.671069974640072, 0.6471251660949373, 0.6341617383931352, 0.5969924642024836, 0.5589417819914553, 0.545367138409257, 0.5424362936202126, 0.5265942318373591, 0.5225394798256111, 0.510200135376198, 0.502706639375729, 0.4668527104668121, 0.45971246623603457, 0.4533123532500259, 0.45913849136659474, 0.4630346400135384, 0.45162069061769416, 0.44187378997716265, 0.42641070261352587, 0.40864470856817864, 0.4008564329832643, 0.359428265159954, 0.35890481017924625, 0.35491996288347216, 0.35546220730184835, 0.35209049337470183, 0.30925742624867203, 0.3017641437630191, 0.273678881939046, 0.2693828414729971, 0.2744207873745108]"
#SDRIn = "[0.6028257742216583,0.5728020399096223,0.5808347332754236,0.5773147909700058,0.5649946309254676,0.5683874022154849,0.5833362825101767,0.5822554375505784,0.5888481611593969,0.6050259567052978,0.6126154303881319,0.6259425782931115,0.6379015758125838,0.6406345374586915,0.6424567611881681,0.651324485383072,0.6600617880108114,0.6585464911309613,0.6650706268432791,0.6708770444059484,0.6779043371413246,0.6807021544246189,0.6824223838785193,0.6857911672907977,0.689166205379945,0.6887885169598843,0.6887795378577183,0.6921321543875513,0.6950603840398976,0.6965555336905844,0.6963768375444447,0.6979691665286168,0.6715793153292651,0.6734144046863075,0.6390853771386025,0.6378915837686476,0.6397660382686629,0.6424824449133912,0.6429721589711024,0.6430536083420528,0.643989066460427,0.6446333200999359,0.6448341388974713,0.6449147031109034,0.6461761025471754,0.609654246482029,0.6136990842252645,0.6174994216900261,0.6205115375142943]"
SDRIn = args[1]
#clusterId = "test"
clusterId = args[2]
outputFolder = args[3]
#outputFolder = "/Users/ewout/Documents/phylogeo/Configs/sgolay";

SDR=strsplit(substr(SDRIn,2,nchar(SDRIn) - 1),",")
x <- c(1:length(SDR[[1]]))

firstDerivative <- 0
#Calculate the first derivative
# (yi+1 - yi-1)/(xi+1 - xi-1)

# Calculate for the first point
# (y2-y1)/(x2-x1)
x <- c(1:(length(SDR[[1]])))
firstDerivative[1] <- (as.numeric(SDR[[1]][2]) - as.numeric(SDR[[1]][1]))
print(paste0("1", 1, ": value: ", firstDerivative[1]))
for (i in 2:(length(SDR[[1]]) - 1) ) {
  firstDerivative[i] <- ((as.numeric(SDR[[1]][i+1]) - as.numeric(SDR[[1]][i-1])) / ((i+1) - (i-1)))
  print(paste0("i", i, ": value: ", firstDerivative[i]))
}
# Calculate the last point
# (yn-yn-1)/(xn-xn-1)
firstDerivative[length(SDR[[1]])] <- ((as.numeric(SDR[[1]][length(SDR[[1]])]) - as.numeric(SDR[[1]][length(SDR[[1]]) - 1])) / (length(SDR[[1]]) - (length(SDR[[1]]) - 1)))
print(paste0("i", length(SDR[[1]]), ": value: ", firstDerivative[length(SDR[[1]])]))

sum(firstDerivative)
firstDerivativeDF <- matrix(unlist(firstDerivative))
png(file=paste(paste(outputFolder,"/r/",clusterId, sep=""),"_firstderivative.png", sep=""), bg="transparent")
plot(xlab = "Nr Clusters", ylab = "First Derivative", x=x, y=firstDerivativeDF, type="o")
abline(h = 0)
dev.off()